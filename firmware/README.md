# How To Setup a C++ Visual Studio Project

Due to some lovely STM32 and Visual Studio screwery, setting up a local project to edit firmware files is not as easy as it should be.

## Requirements

- SysProgs VisualGDB plugin
- Visual Studio 2015 (other versions untested)
- Up to date source repo (MicroMouse2017)
	
## Creating the Project

1. Open VS and click ```File > New > Project > Embedded Project Wizard```
2. Give the project a name, and uncheck the option ```create directory for solution```
3. Click OK
4. In the new window, click ```Create a new project``` and uncheck ```Copy imported files to project directory```, and make sure ```Create a C++ file``` is ticked.
5. On the next page, find the correct MCU, ```STM32L476RG```, and click next
6. On the next page, select to top level folder in the micromouse repository directory i.e. ```...Some/Path/MicroMouse2017/firmware```, click next
7. Click finish.

## Fixing Settings in Visual Studio

1. Now the project has been created. In the Solution Explorer, under ```Source Files```, right-click on ```system_stm32l4xx.c``` and click ```Remove```, then ```Delete```.
2. Do the same for ```startup_stm32l476xx.c```, under ```Device-specific files```. Right-click on ```Source files```, and click ```Add->Existing Item```. Navigate to ```firmware/Src``` and select every file in that folder.
3. Do the same for ```Header files```; add every file into it from ```firmware/Inc``` EXCEPT for ```stm32l4xx_hal_conf.h```. Leave the one that is there.
4. Now try to build. The first error you will get is most likely ```adc.h``` (or similar) cannot be found. Open the file triggering the error and let Intellisense search for the file. It will find it in the ```firmware/Inc``` directory and prompt you to add this directory to your build properties; do so and rebuild.
5. The next (and hopefully last) error you will get is something like ```multiple definitions of SysTick_Handler()```. Go into your main C++ file and remove its definition there.

## Notes

- Files generated by CubeMX will not be updated by Visual Studio until the project is reloaded or restarted