# How To Setup a Visual Studio Project

Due to some lovely STM32 and Visual Studio screwery, setting up a local project to edit firmware files is not as easy as it should be.

## Requirements

- SysProgs VisualGDB plugin
- Visual Studio 2015 (other versions untested)
- Up to date source repo (MicroMouse2017)
	
## Creating the Project

1. Open VS and click ```File > New > Project > Embedded Project Wizard```
2. Give the projcet a name, and uncheck the option ```create directory for solution```
3. Click OK
4. In the new window, click ```Import a project built with command-line tools``` and uncheck ```Copy imported files to project directory```, click next
5. On the next page, find the correct MCU, ```STM32L476RG```, and click next
6. On the next page, select to top level folder in the micromouse repository directory i.e. ```...Some/Path/MicroMouse2017/firmware```, click next
7. Click finish.

## Fixing Settings in Visual Studio

1. Navigate to ```Project > VisualGDB Project Properties > MSBuild Settings``` and add the path to your ```.../MicroMouse2017/firmware/Inc``` directory
2. In your local project directory, open ```myproj.vcxproj``` in a text editor
3. Scroll to where you see entries of the type ```<ClCompile Include="../MicroMouse2017/firmware/Inc/somefile.h" />```
4. Delete all entries, and add a new entry, ```<ClInclude Include="../MicroMouse2017/firmware/Inc/*.h" />``` where the path is *your* path
5. Do the same for the entries of the type ```<ClCompile Include="../MicroMouse2017/firmware/Src/somefile.c" />```, adding entries for ```*.c```, ```*.cc```, and ```*.cpp```
6. Find the toolchain entry for the file ```...Some/Path/Source/Templates/system_stm32l4xx.c``` in the Compile and Include entries, and remove them. This file is provided through CubeMX and is not required
7. Test the changes by unloading and reloading the project, or restarting visual studio
	
## Notes

- Files generated by CubeMX will not be updated by Visual Studio until the project is reloaded or restarted